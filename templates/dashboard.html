{% extends 'base.html' %}

{% block title %}
  <title>
  Koi Dashboard
  </title>
{% endblock%}}

{% block body %}
   <div id="wrapper">

        <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand"><a href="/">Koi</a></li>
                <li><a href="/dashboard">Main<span></span></a></li>
                <li><a href="/activity">Activity<span></span></a></li>
                <li><a href="/optimize">Optimize<span></span></a></li>
                <li><a href="/logout">Log Out<span></span></a></li>
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-xs-12">

                      
                          <!-- Show flashed messages -->
                          {% with messages = get_flashed_messages() %}
                              {% for message in messages %}
                                  <div class="alert alert-warning">{{ message }}</div>
                              {% endfor %}
                          {% endwith %}


                        <h1>Main Dashboard</h1>
                        <a href="#menu-toggle" class="btn btn-default" id="menu-toggle">Toggle Menu</a>

                        <div id="d3-div"></div> 
                        <script src="/static/js/userD3.js"></script>
                  
                </div>
                <div class="row">

      <section class="col-xs-4">

        <form id="update-balance-form" method="POST" autocomplete="off">

          <label for="program">Update </label>
          <input type="text" id="program" list="all-programs" placeholder="Select program" required>

            <datalist id="all-programs">
              {% for program in programs | sort(attribute="program_name") %}
                <option data-value="{{ program.program_id }}" value="{{ program.program_name }}">
              {% endfor %}
            </datalist>
          
          <label for="current-balance">Balance: </label>
          <input type="number" name="balance" id="current-balance" min="1" max="1000000000" maxlength="10" placeholder="Enter points" required></input>

          <input type="reset" class="reset-btn" value="Reset">
          <input type="submit" id="submit-balance" value="Submit">

        </form>

        <form id="transfer-form" method="POST" autocomplete="off">
          
          <label for="outgoing">Transfer </label>
          <input type="text" id="outgoing" list="all-outgoing-programs" placeholder="Select program" required>


          <datalist id="all-outgoing-programs">
              {% for program in outgoing %}
                  <option data-value="{{ program.outgoing_program }}" value="{{ program.outgoing.program_name }}">
              {% endfor %}
          </datalist>
          
          <label for="receiving">To </label>
          <input type="text" id="receiving" list="all-receiving-programs" placeholder="Select program" required>

          <datalist id="all-receiving-programs">
          </datalist>

          <label id="ratio" hidden></label>
          <br>
          <label for="transfer-amount">Amount: </label>
          <input type="number" name="balance" id="transfer-amount" min="1" max="1000000000" maxlength="10" placeholder="Enter points" required></input>

          <input type="reset" class="reset-btn" value="Reset">
          <input type="submit" id="submit-balance" value="Submit">
        </form>
      </section>

      <section class="col-xs-6 col-xs-offset-1">
          <table class="table table-hover table-striped" id="program-balance">
              <thead>
                  <tr>
                      <th class="nitems"></th>
                      <th class="nitems"></th>
                      <th>Program</th>
                      <th class="current_bal_col">Current Balance</th>
                      <th>Last Updated</th>
                  </tr>
              </thead>
              <tfoot>
                  <tr>
                      <th></th>
                      <th></th>
                      <th>Program</th>
                      <th>Current Balance</th>
                      <th>Last Updated</th>
                  </tr>
              </tfoot>
              <tbody>
              {% if balances %}
                  {% for balance in balances | sort(attribute="program.program_name") %}
                      <tr id="{{ balance.program_id }}">
                          <td class="remove"><span class="glyphicon glyphicon-minus-sign"></span></td>
                          <td class="index">{{ loop.index }}</td>
                          <td class="program_name dt-left">{{ balance.program.program_name }}</td>
                          <td class="current_balance dt-right">{{ "{:,}".format(balance.current_balance) }}</td>
                          <td class="updated_at">{{ moment(balance.updated_at).format('M/D/YYYY, h:mm a') }}</td>
                      </tr>
                  {% endfor %}
              {% endif %}
          </tbody>
          </table>
      </section>
    </div>
  </div>
<script src="/static/js/dashboard_update.js"></script>

            </div>
        </div>
        <!-- /#page-content-wrapper -->

    </div>
    <!-- /#wrapper -->
     <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>

{% endblock%}}
